<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EdgeBet AI v4.0 - Complete Betting Platform</title>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#22d3ee">
  <style>
    :root {
      --accent: #22d3ee;
      --accent2: #a78bfa;
      --success: #4ade80;
      --danger: #ef4444;
      --warning: #fb923c;
      --bg: #09090b;
      --card: rgba(255,255,255,0.03);
    }
    
    [data-theme="light"] {
      --bg: #f5f5f5;
      --card: #ffffff;
      color: #1a1a1a;
    }
    
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      background: var(--bg);
      color: #fff;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      min-height: 100vh;
      transition: background 0.3s;
    }
    
    .app {
      max-width: 480px;
      margin: 0 auto;
      min-height: 100vh;
      position: relative;
    }
    
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
    @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
    
    .header {
      padding: 12px 16px;
      border-bottom: 1px solid rgba(255,255,255,0.07);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      background: rgba(9,9,11,0.95);
      backdrop-filter: blur(20px);
      z-index: 50;
    }
    
    .logo { font-size: 20px; font-weight: 900; background: linear-gradient(90deg, var(--accent), var(--accent2) 60%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .live-badge { display: flex; align-items: center; gap: 5px; background: rgba(74,222,128,0.09); border: 1px solid rgba(74,222,128,0.2); border-radius: 99px; padding: 4px 10px; font-size: 11px; color: var(--success); }
    .live-dot { width: 6px; height: 6px; background: var(--success); border-radius: 50%; animation: pulse 1.5s infinite; }
    
    .content { padding: 16px 16px 100px; display: none; }
    .content.active { display: block; animation: fadeInUp 0.4s ease-out; }
    
    .page-title { font-size: 24px; font-weight: 900; margin-bottom: 20px; }
    .section-title { font-size: 14px; font-weight: 700; color: #9ca3af; margin: 24px 0 12px; text-transform: uppercase; letter-spacing: 0.5px; }
    
    /* Buttons */
    .btn {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #0891b2, #7c3aed);
      border: none;
      border-radius: 16px;
      color: #fff;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      margin-bottom: 16px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .btn:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(34,211,238,0.2); }
    .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .btn-secondary { background: rgba(255,255,255,0.1); }
    .btn-success { background: linear-gradient(135deg, #10b981, #059669); }
    .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); }
    
    /* Cards */
    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 20px;
      padding: 20px;
      margin-bottom: 12px;
      animation: fadeInUp 0.4s ease-out;
    }
    
    /* Form Elements */
    .input-group { margin-bottom: 16px; }
    .input-group label { display: block; font-size: 13px; color: #9ca3af; margin-bottom: 6px; }
    .input {
      width: 100%;
      padding: 14px 16px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      transition: border-color 0.2s;
    }
    .input:focus { border-color: var(--accent); outline: none; }
    
    /* EV Calculator Specific */
    .ev-result {
      background: linear-gradient(135deg, rgba(34,211,238,0.1), rgba(167,139,250,0.1));
      border: 1px solid rgba(34,211,238,0.3);
      border-radius: 16px;
      padding: 24px;
      text-align: center;
      margin-top: 20px;
    }
    .ev-positive { border-color: var(--success); background: linear-gradient(135deg, rgba(74,222,128,0.1), rgba(74,222,128,0.05)); }
    .ev-negative { border-color: var(--danger); background: linear-gradient(135deg, rgba(239,68,68,0.1), rgba(239,68,68,0.05)); }
    .ev-grade { font-size: 64px; font-weight: 900; }
    .ev-grade.a { color: var(--success); }
    .ev-grade.f { color: var(--danger); }
    .ev-stat { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.05); }
    .ev-stat:last-child { border-bottom: none; }
    
    /* Parlay Builder */
    .parlay-leg {
      display: flex;
      gap: 12px;
      align-items: center;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 12px;
      margin-bottom: 8px;
    }
    .parlay-leg .input { flex: 1; margin-bottom: 0; }
    .parlay-remove { background: var(--danger); border: none; border-radius: 8px; padding: 8px 12px; color: #fff; cursor: pointer; }
    
    /* Line Shopping */
    .book-compare {
      display: grid;
      grid-template-columns: 1fr 1fr 1fr;
      gap: 8px;
      margin-top: 12px;
    }
    .book-cell {
      text-align: center;
      padding: 12px;
      background: rgba(255,255,255,0.03);
      border-radius: 10px;
      font-size: 12px;
    }
    .book-cell.best { border: 1px solid var(--success); background: rgba(74,222,128,0.05); }
    .book-name { font-size: 10px; color: #6b7280; margin-bottom: 4px; text-transform: uppercase; }
    .book-odds { font-size: 14px; font-weight: 700; font-family: monospace; }
    
    /* Steam Moves */
    .steam-card {
      background: linear-gradient(135deg, rgba(251,146,60,0.1), rgba(251,146,60,0.05));
      border: 1px solid rgba(251,146,60,0.3);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .steam-indicator { display: inline-block; width: 8px; height: 8px; background: var(--warning); border-radius: 50%; animation: pulse 1s infinite; margin-right: 8px; }
    
    /* Weather */
    .weather-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      background: rgba(255,255,255,0.03);
      border-radius: 16px;
      margin-bottom: 12px;
    }
    .weather-icon { font-size: 40px; }
    .weather-temp { font-size: 32px; font-weight: 900; }
    .weather-detail { font-size: 12px; color: #9ca3af; }
    .weather-impact { margin-top: 8px; padding: 6px 12px; border-radius: 99px; font-size: 11px; font-weight: 700; display: inline-block; }
    .weather-impact.high { background: rgba(239,68,68,0.15); color: var(--danger); }
    .weather-impact.medium { background: rgba(251,146,60,0.15); color: var(--warning); }
    
    /* Navigation */
    .nav {
      position: fixed;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
      max-width: 480px;
      background: rgba(9,9,11,0.95);
      backdrop-filter: blur(20px);
      border-top: 1px solid rgba(255,255,255,0.08);
      display: flex;
      justify-content: space-around;
      padding: 10px 0 24px;
      z-index: 100;
      overflow-x: auto;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      background: none;
      border: none;
      color: #6b7280;
      font-size: 9px;
      cursor: pointer;
      padding: 4px 8px;
      white-space: nowrap;
      min-width: 50px;
    }
    .nav-item:hover, .nav-item.active { color: var(--accent); }
    .nav-item svg { width: 22px; height: 22px; }
    
    /* Tools Grid */
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }
    .tool-card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tool-card:hover { border-color: var(--accent); transform: translateY(-2px); }
    .tool-icon { font-size: 32px; margin-bottom: 8px; }
    .tool-name { font-size: 13px; font-weight: 700; }
    .tool-desc { font-size: 11px; color: #6b7280; margin-top: 4px; }
    
    /* Empty State */
    .empty-state { text-align: center; padding: 60px 20px; color: #6b7280; }
    .empty-state svg { width: 64px; height: 64px; margin-bottom: 16px; opacity: 0.5; }
    
    /* Loading */
    .loading { text-align: center; padding: 40px; color: #6b7280; }
    .spinner { width: 40px; height: 40px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* Toast */
    .toast { position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(100px); background: rgba(0,0,0,0.9); border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 16px 24px; color: #fff; font-size: 14px; z-index: 300; opacity: 0; transition: all 0.3s ease; }
    .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }
  </style>
</head>
<body>
  <div class="app">
    <div class="header">
      <div class="logo">EdgeBet AI</div>
      <div style="display: flex; gap: 8px; align-items: center;">
        <button onclick="toggleTheme()" style="background: none; border: none; font-size: 20px; cursor: pointer;">üåì</button>
        <div class="live-badge"><div class="live-dot"></div><span>LIVE</span></div>
      </div>
    </div>

    <!-- HOME / TOOLS PAGE -->
    <div id="home-page" class="content active">
      <div class="page-title">Betting Tools</div>
      <div class="tools-grid">
        <div class="tool-card" onclick="showPage('ev')">
          <div class="tool-icon">üßÆ</div>
          <div class="tool-name">EV Calculator</div>
          <div class="tool-desc">Find expected value</div>
        </div>
        <div class="tool-card" onclick="showPage('parlay')">
          <div class="tool-icon">üîó</div>
          <div class="tool-name">Parlay Builder</div>
          <div class="tool-desc">Build +EV parlays</div>
        </div>
        <div class="tool-card" onclick="showPage('lines')">
          <div class="tool-icon">üìä</div>
          <div class="tool-name">Line Shopping</div>
          <div class="tool-desc">Compare all books</div>
        </div>
        <div class="tool-card" onclick="showPage('steam')">
          <div class="tool-icon">‚ö°</div>
          <div class="tool-name">Steam Moves</div>
          <div class="tool-desc">Track sharp action</div>
        </div>
        <div class="tool-card" onclick="showPage('weather')">
          <div class="tool-icon">üå§Ô∏è</div>
          <div class="tool-name">Weather</div>
          <div class="tool-desc">NFL/MLB impacts</div>
        </div>
        <div class="tool-card" onclick="showPage('journal')">
          <div class="tool-icon">üìù</div>
          <div class="tool-name">Journal</div>
          <div class="tool-desc">Track your bets</div>
        </div>
        <div class="tool-card" onclick="showPage('picks')">
          <div class="tool-icon">üéØ</div>
          <div class="tool-name">AI Picks</div>
          <div class="tool-desc">7-agent system</div>
        </div>
        <div class="tool-card" onclick="showPage('arb')">
          <div class="tool-icon">üí∞</div>
          <div class="tool-name">Arbitrage</div>
          <div class="tool-desc">Risk-free profits</div>
        </div>
      </div>
      
      <div class="section-title">Quick Stats</div>
      <div class="card">
        <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; text-align: center;">
          <div><div style="font-size: 28px; font-weight: 900; color: var(--accent);">+12.5%</div><div style="font-size: 11px; color: #6b7280;">ROI This Month</div></div>
          <div><div style="font-size: 28px; font-weight: 900; color: var(--success);">142</div><div style="font-size: 11px; color: #6b7280;">Total Picks</div></div>
          <div><div style="font-size: 28px; font-weight: 900; color: var(--warning);">8</div><div style="font-size: 11px; color: #6b7280;">Arbs Today</div></div>
        </div>
      </div>
    </div>

    <!-- EV CALCULATOR PAGE -->
    <div id="ev-page" class="content">
      <div class="page-title">EV Calculator</div>
      <div class="card">
        <div class="input-group">
          <label>True Win Probability (%)</label>
          <input type="number" class="input" id="ev-true-prob" placeholder="55" min="1" max="99">
        </div>
        <div class="input-group">
          <label>American Odds</label>
          <input type="number" class="input" id="ev-odds" placeholder="-110 or +150">
        </div>
        <div class="input-group">
          <label>Bankroll ($)</label>
          <input type="number" class="input" id="ev-bankroll" placeholder="1000" value="1000">
        </div>
        <div class="input-group">
          <label>Kelly Fraction (1/4 = 0.25)</label>
          <input type="number" class="input" id="ev-kelly" placeholder="0.25" value="0.25" step="0.05" min="0.05" max="1">
        </div>
        <button class="btn" onclick="calculateEV()">Calculate EV</button>
        <div id="ev-result"></div>
      </div>
    </div>

    <!-- PARLAY BUILDER PAGE -->
    <div id="parlay-page" class="content">
      <div class="page-title">Parlay Builder</div>
      <div id="parlay-legs">
        <div class="parlay-leg">
          <input type="text" class="input" placeholder="Leg 1 (e.g., Lakers -4.5)" id="leg-0-text">
          <input type="number" class="input" placeholder="Odds" id="leg-0-odds" style="width: 100px;">
          <input type="number" class="input" placeholder="Edge%" id="leg-0-edge" style="width: 80px;">
        </div>
      </div>
      <button class="btn btn-secondary" onclick="addParlayLeg()">+ Add Leg</button>
      <button class="btn" onclick="calculateParlay()">Calculate Parlay</button>
      <div id="parlay-result"></div>
    </div>

    <!-- LINE SHOPPING PAGE -->
    <div id="lines-page" class="content">
      <div class="page-title">Line Shopping</div>
      <div class="input-group">
        <label>Select Game</label>
        <select class="input" id="line-game">
          <option>Lakers vs Warriors - Tonight</option>
          <option>Chiefs vs Bills - Sunday</option>
          <option>Rangers vs Devils - Tonight</option>
        </select>
      </div>
      <button class="btn" onclick="loadLines()">Compare Lines</button>
      <div id="lines-result"></div>
    </div>

    <!-- STEAM MOVES PAGE -->
    <div id="steam-page" class="content">
      <div class="page-title">Steam Moves</div>
      <div class="card" style="background: linear-gradient(135deg, rgba(251,146,60,0.1), rgba(251,146,60,0.05)); border-color: rgba(251,146,60,0.3);">
        <div style="font-size: 14px; color: #9ca3af; margin-bottom: 8px;">‚ö° Live Tracking</div>
        <div style="font-size: 13px;">Monitoring sharp book movements in real-time. Rapid line changes often indicate smart money or breaking news.</div>
      </div>
      <button class="btn" onclick="loadSteamMoves()">Refresh Steam Moves</button>
      <div id="steam-container"></div>
    </div>

    <!-- WEATHER PAGE -->
    <div id="weather-page" class="content">
      <div class="page-title">Weather Impact</div>
      <div class="input-group">
        <label>Search Stadium/City</label>
        <input type="text" class="input" id="weather-city" placeholder="e.g., Green Bay, Foxborough">
      </div>
      <button class="btn" onclick="loadWeather()">Check Weather</button>
      <div id="weather-container"></div>
    </div>

    <!-- JOURNAL PAGE -->
    <div id="journal-page" class="content">
      <div class="page-title">Betting Journal</div>
      <button class="btn" onclick="showJournalEntry()">+ New Entry</button>
      <div id="journal-form" style="display: none;">
        <div class="card">
          <div class="input-group">
            <label>Bet Description</label>
            <input type="text" class="input" id="journal-bet" placeholder="Lakers -4.5">
          </div>
          <div class="input-group">
            <label>Stake ($)</label>
            <input type="number" class="input" id="journal-stake" placeholder="100">
          </div>
          <div class="input-group">
            <label>Notes / Strategy</label>
            <input type="text" class="input" id="journal-notes" placeholder="RLM detected, fading public">
          </div>
          <button class="btn btn-success" onclick="saveJournalEntry()">Save Entry</button>
        </div>
      </div>
      <div class="section-title">Recent Entries</div>
      <div id="journal-entries"></div>
    </div>

    <!-- PICKS PAGE -->
    <div id="picks-page" class="content">
      <div class="page-title">AI Picks</div>
      <button class="btn" onclick="scanPicks()" id="scanBtn">‚ö° SCAN FOR PICKS</button>
      <div id="picks-container"></div>
    </div>

    <!-- ARB PAGE -->
    <div id="arb-page" class="content">
      <div class="page-title">Arbitrage</div>
      <button class="btn btn-warning" onclick="loadArbitrage()">üî• FIND ARBS</button>
      <div id="arb-container"></div>
    </div>

    <!-- NAVIGATION -->
    <div class="nav">
      <button class="nav-item active" onclick="showPage('home')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
        <span>Home</span>
      </button>
      <button class="nav-item" onclick="showPage('ev')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
        <span>EV</span>
      </button>
      <button class="nav-item" onclick="showPage('parlay')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"/></svg>
        <span>Parlay</span>
      </button>
      <button class="nav-item" onclick="showPage('picks')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <span>Picks</span>
      </button>
      <button class="nav-item" onclick="showPage('journal')">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
        <span>Journal</span>
      </button>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const BACKEND = "https://edgebet-backend-1.onrender.com";
    let parlayLegCount = 1;
    
    // Navigation
    function showPage(pageName) {
      document.querySelectorAll('.content').forEach(p => p.classList.remove('active'));
      document.getElementById(pageName + '-page').classList.add('active');
      document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
      event.currentTarget.classList.add('active');
    }
    
    // Theme Toggle
    function toggleTheme() {
      const current = document.documentElement.getAttribute('data-theme');
      const next = current === 'light' ? 'dark' : 'light';
      document.documentElement.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
    }
    
    // Load saved theme
    if (localStorage.getItem('theme') === 'light') {
      document.documentElement.setAttribute('data-theme', 'light');
    }
    
    // Toast
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }
    
    // EV Calculator
    async function calculateEV() {
      const trueProb = parseFloat(document.getElementById('ev-true-prob').value);
      const odds = parseFloat(document.getElementById('ev-odds').value);
      const bankroll = parseFloat(document.getElementById('ev-bankroll').value) || 1000;
      const kelly = parseFloat(document.getElementById('ev-kelly').value) || 0.25;
      
      if (!trueProb || !odds) {
        showToast('Enter probability and odds');
        return;
      }
      
      try {
        const res = await fetch(`${BACKEND}/ev-calculator`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ trueProbability: trueProb, odds, bankroll, kellyFraction: kelly })
        });
        const data = await res.json();
        
        const isPos = parseFloat(data.ev) > 0;
        document.getElementById('ev-result').innerHTML = `
          <div class="ev-result ${isPos ? 'ev-positive' : 'ev-negative'}">
            <div class="ev-grade ${isPos ? 'a' : 'f'}">${data.rating}</div>
            <div style="font-size: 14px; color: #9ca3af; margin-bottom: 16px;">${isPos ? 'Positive EV Bet' : 'Negative EV - Skip'}</div>
            <div class="ev-stat"><span>Expected Value</span><span style="color: ${isPos ? 'var(--success)' : 'var(--danger)'}">${data.ev}%</span></div>
            <div class="ev-stat"><span>Edge vs Market</span><span>${data.edge}%</span></div>
            <div class="ev-stat"><span>Recommended Stake</span><span style="color: var(--accent);">$${data.recommendedStake}</span></div>
            <div class="ev-stat"><span>Breakeven Win Rate</span><span>${data.breakevenProbability}%</span></div>
          </div>
        `;
      } catch (e) {
        showToast('Calculation failed');
      }
    }
    
    // Parlay Builder
    function addParlayLeg() {
      const container = document.getElementById('parlay-legs');
      const div = document.createElement('div');
      div.className = 'parlay-leg';
      div.innerHTML = `
        <input type="text" class="input" placeholder="Leg ${parlayLegCount + 1}" id="leg-${parlayLegCount}-text">
        <input type="number" class="input" placeholder="Odds" id="leg-${parlayLegCount}-odds" style="width: 100px;">
        <input type="number" class="input" placeholder="Edge%" id="leg-${parlayLegCount}-edge" style="width: 80px;">
        <button class="parlay-remove" onclick="this.parentElement.remove()">√ó</button>
      `;
      container.appendChild(div);
      parlayLegCount++;
    }
    
    async function calculateParlay() {
      const legs = [];
      for (let i = 0; i < parlayLegCount; i++) {
        const odds = document.getElementById(`leg-${i}-odds`)?.value;
        const edge = document.getElementById(`leg-${i}-edge`)?.value;
        if (odds) {
          legs.push({ odds: parseFloat(odds), edge: parseFloat(edge) || 0, trueProb: 50 });
        }
      }
      
      if (legs.length < 2) {
        showToast('Add at least 2 legs');
        return;
      }
      
      try {
        const res = await fetch(`${BACKEND}/parlay-calculator`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ legs })
        });
        const data = await res.json();
        
        const isPos = data.isPositive;
        document.getElementById('parlay-result').innerHTML = `
          <div class="card ${isPos ? 'ev-positive' : 'ev-negative'}" style="margin-top: 20px;">
            <div style="font-size: 32px; font-weight: 900; color: ${isPos ? 'var(--success)' : 'var(--danger)'};">${data.americanOdds}</div>
            <div style="font-size: 14px; color: #9ca3af; margin-bottom: 16px;">${data.legs} Leg Parlay</div>
            <div class="ev-stat"><span>Expected Value</span><span style="color: ${isPos ? 'var(--success)' : 'var(--danger)'}">${data.ev}%</span></div>
            <div class="ev-stat"><span>True Probability</span><span>${data.trueProbability}%</span></div>
            <div class="ev-stat"><span>Recommendation</span><span style="color: ${isPos ? 'var(--success)' : 'var(--warning)'}">${data.stake}</span></div>
          </div>
        `;
      } catch (e) {
        showToast('Calculation failed');
      }
    }
    
    // Line Shopping
    async function loadLines() {
      const container = document.getElementById('lines-result');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading lines...</div>';
      
      // Simulated data - in production this would come from backend
      setTimeout(() => {
        container.innerHTML = `
          <div class="card">
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 12px;">Lakers -4.5</div>
            <div class="book-compare">
              <div class="book-cell best"><div class="book-name">FanDuel</div><div class="book-odds" style="color: var(--success)">-105</div></div>
              <div class="book-cell"><div class="book-name">DraftKings</div><div class="book-odds">-110</div></div>
              <div class="book-cell"><div class="book-name">BetMGM</div><div class="book-odds">-115</div></div>
            </div>
            <div style="margin-top: 12px; padding: 12px; background: rgba(74,222,128,0.1); border-radius: 8px; font-size: 13px;">
              <strong>Best Value:</strong> FanDuel at -105 saves you $4.76 per $100 bet vs worst line
            </div>
          </div>
        `;
      }, 1000);
    }
    
    // Steam Moves
    async function loadSteamMoves() {
      const container = document.getElementById('steam-container');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Scanning for steam...</div>';
      
      try {
        const res = await fetch(`${BACKEND}/steam-moves/basketball_nba`);
        const data = await res.json();
        
        if (!data.moves || data.moves.length === 0) {
          container.innerHTML = '<div class="empty-state">No significant line movements detected</div>';
          return;
        }
        
        container.innerHTML = data.moves.slice(0, 5).map(m => `
          <div class="steam-card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div style="font-weight: 700;">${m.game}</div>
              ${m.steam ? '<span style="background: var(--warning); color: #000; padding: 2px 8px; border-radius: 99px; font-size: 10px; font-weight: 700;">STEAM</span>' : ''}
            </div>
            <div style="font-size: 13px; color: #9ca3af;">${m.book} ‚Ä¢ ${m.market}</div>
            <div style="margin-top: 8px; font-family: monospace;">
              ${m.oldLine} ‚Üí <span style="color: ${m.pointChange > 0 ? 'var(--success)' : 'var(--danger)'}; font-weight: 700;">${m.newLine}</span>
              <span style="font-size: 12px; margin-left: 8px;">(${m.pointChange > 0 ? '+' : ''}${m.pointChange})</span>
            </div>
          </div>
        `).join('');
      } catch (e) {
        container.innerHTML = '<div class="empty-state">Steam move tracking unavailable</div>';
      }
    }
    
    // Weather
    async function loadWeather() {
      const city = document.getElementById('weather-city').value;
      if (!city) { showToast('Enter a city'); return; }
      
      const container = document.getElementById('weather-container');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Loading forecast...</div>';
      
      try {
        const res = await fetch(`${BACKEND}/weather/${encodeURIComponent(city)}`);
        const data = await res.json();
        
        const impactClass = data.impact === 'high' ? 'high' : data.impact === 'medium' ? 'medium' : '';
        const impactText = data.impact === 'high' ? '‚ö†Ô∏è HIGH IMPACT - Consider Under' : data.impact === 'medium' ? 'Medium Impact' : 'Low Impact';
        
        container.innerHTML = `
          <div class="weather-card">
            <div class="weather-icon">${data.rain ? 'üåßÔ∏è' : data.wind > 15 ? 'üí®' : '‚òÄÔ∏è'}</div>
            <div>
              <div class="weather-temp">${data.temp}¬∞F</div>
              <div class="weather-detail">Wind: ${data.wind} mph ${data.rain ? '‚Ä¢ Rain expected' : ''}</div>
              <div class="weather-impact ${impactClass}">${impactText}</div>
            </div>
          </div>
          <div class="card">
            <div style="font-size: 14px; font-weight: 700; margin-bottom: 8px;">Betting Implications</div>
            <div style="font-size: 13px; color: #9ca3af; line-height: 1.6;">
              ${data.wind > 15 ? '‚Ä¢ High winds favor unders in NFL/MLB<br>' : ''}
              ${data.rain ? '‚Ä¢ Rain affects passing game & field conditions<br>' : ''}
              ${data.temp < 32 ? '‚Ä¢ Cold weather = lower scoring typically<br>' : ''}
              ${data.impact === 'none' ? '‚Ä¢ Weather is neutral factor' : ''}
            </div>
          </div>
        `;
      } catch (e) {
        container.innerHTML = '<div class="empty-state">Weather data unavailable</div>';
      }
    }
    
    // Journal
    function showJournalEntry() {
      document.getElementById('journal-form').style.display = 'block';
    }
    
    function saveJournalEntry() {
      const bet = document.getElementById('journal-bet').value;
      const stake = document.getElementById('journal-stake').value;
      const notes = document.getElementById('journal-notes').value;
      
      if (!bet) { showToast('Enter bet description'); return; }
      
      const entries = JSON.parse(localStorage.getItem('edgebet_journal') || '[]');
      entries.unshift({ bet, stake, notes, date: new Date().toLocaleDateString(), id: Date.now() });
      localStorage.setItem('edgebet_journal', JSON.stringify(entries));
      
      document.getElementById('journal-form').style.display = 'none';
      document.getElementById('journal-bet').value = '';
      document.getElementById('journal-stake').value = '';
      document.getElementById('journal-notes').value = '';
      
      loadJournalEntries();
      showToast('Entry saved!');
    }
    
    function loadJournalEntries() {
      const entries = JSON.parse(localStorage.getItem('edgebet_journal') || '[]');
      const container = document.getElementById('journal-entries');
      
      if (entries.length === 0) {
        container.innerHTML = '<div class="empty-state">No entries yet</div>';
        return;
      }
      
      container.innerHTML = entries.map(e => `
        <div class="card">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <span style="font-weight: 700;">${e.bet}</span>
            <span style="color: #6b7280; font-size: 12px;">${e.date}</span>
          </div>
          ${e.stake ? `<div style="font-size: 13px; color: var(--accent); margin-bottom: 4px;">$${e.stake}</div>` : ''}
          ${e.notes ? `<div style="font-size: 13px; color: #9ca3af;">${e.notes}</div>` : ''}
        </div>
      `).join('');
    }
    
    // Picks
    async function scanPicks() {
      const btn = document.getElementById('scanBtn');
      const container = document.getElementById('picks-container');
      
      btn.disabled = true;
      btn.textContent = 'Scanning...';
      container.innerHTML = '<div class="loading"><div class="spinner"></div>7 agents analyzing...</div>';
      
      try {
        const res = await fetch(`${BACKEND}/scan`);
        const data = await res.json();
        
        if (!data.consensus_picks || data.consensus_picks.length === 0) {
          container.innerHTML = '<div class="empty-state">No picks available right now</div>';
          return;
        }
        
        container.innerHTML = data.consensus_picks.map(p => `
          <div class="card">
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <span style="color: #9ca3af; font-size: 13px;">${p.sport}</span>
              <span style="background: var(--accent); color: #000; padding: 4px 10px; border-radius: 99px; font-size: 11px; font-weight: 700;">+${p.edge}% EDGE</span>
            </div>
            <div style="font-size: 20px; font-weight: 900; margin-bottom: 4px;">${p.bet}</div>
            <div style="font-size: 14px; color: #6b7280; margin-bottom: 8px;">${p.game}</div>
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <span style="font-family: monospace; font-size: 18px; color: var(--success); font-weight: 700;">${p.odds}</span>
              <span style="font-size: 13px; color: #9ca3af;">${p.confidence}% confidence</span>
            </div>
          </div>
        `).join('');
      } catch (e) {
        container.innerHTML = '<div class="empty-state">Scan failed. Try again.</div>';
      } finally {
        btn.disabled = false;
        btn.textContent = '‚ö° SCAN AGAIN';
      }
    }
    
    // Arbitrage
    async function loadArbitrage() {
      const container = document.getElementById('arb-container');
      container.innerHTML = '<div class="loading"><div class="spinner"></div>Finding arbitrage opportunities...</div>';
      
      try {
        const res = await fetch(`${BACKEND}/arbitrage`);
        const data = await res.json();
        
        if (!data.opportunities || data.opportunities.length === 0) {
          container.innerHTML = '<div class="empty-state">No arbs available right now. Lines are tight.</div>';
          return;
        }
        
        container.innerHTML = data.opportunities.slice(0, 5).map(a => `
          <div class="card" style="border-color: var(--warning); background: linear-gradient(135deg, rgba(251,146,60,0.05), rgba(251,146,60,0.02));">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
              <div style="font-size: 14px; color: #9ca3af;">${a.sport}</div>
              <div style="font-size: 28px; font-weight: 900; color: var(--warning);">+${a.profit}%</div>
            </div>
            <div style="font-size: 16px; font-weight: 700; margin-bottom: 8px;">${a.game}</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-top: 12px; padding-top: 12px; border-top: 1px solid rgba(251,146,60,0.2);">
              <div>
                <div style="font-size: 11px; color: #6b7280; text-transform: uppercase;">${a.awayBook}</div>
                <div style="font-size: 16px; font-weight: 700; font-family: monospace;">${a.awayOdds}</div>
                <div style="font-size: 11px; color: #9ca3af;">Bet $${a.stake?.away || '100'}</div>
              </div>
              <div>
                <div style="font-size: 11px; color: #6b7280; text-transform: uppercase;">${a.homeBook}</div>
                <div style="font-size: 16px; font-weight: 700; font-family: monospace;">${a.homeOdds}</div>
                <div style="font-size: 11px; color: #9ca3af;">Bet $${a.stake?.home || '100'}</div>
              </div>
            </div>
          </div>
        `).join('');
      } catch (e) {
        container.innerHTML = '<div class="empty-state">Could not load arbitrage data</div>';
      }
    }
    
    // Init
    document.addEventListener('DOMContentLoaded', () => {
      loadJournalEntries();
    });
    
    // Register Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(console.error);
    }
  </script>
</body>
</html>
